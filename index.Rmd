---
title: "**Practical Machine Learning Assignment**"
author: "*Antoni Parellada*"
date: "*March 8, 2016*"
output: html_document
---

###**Data preparation:**

For now I'm seeing what is already "out there", such in [this repository](https://rpubs.com/DIM302/PracticalMachineLearning).

First let's load the raw data:

```{r, message=F, echo=F, warning=FALSE}
library(caret)
library(rpart)
library(rpart.plot)
training <- read.csv(file = "~/R/Practical_Machine_Learning/pml-training.csv", 
                     header = T, na.strings=c("NA","#DIV/0!",""))
testing <- read.csv(file =
"~/R/Practical_Machine_Learning/pml-testing.csv", 
                     header = T, na.strings=c("NA","#DIV/0!",""))
```

```{r}
dim(training); dim(testing) # That is no.rows x no.columns
```
Partitioning the training dataset:

```{r}
training_rows <-    createDataPartition(training$classe, p = 0.6, list=FALSE)
# training$classe is the vector of outcomes; p is the percentage of data going to training
# list = F makes the result a matrix.
little_train <- training[training_rows,  ]
# This corresponds to...
round(100 * nrow(little_train) / nrow(training), 0) # percentage of the training data
little_test  <- training[-training_rows,  ]
dim(little_train); dim(little_test)
```

Removing variables with near zero variance:

```{r}
head(nzv <- nearZeroVar(little_train, saveMetrics=TRUE))[1:4, ]
nzv <- nearZeroVar(little_train, saveMetrics=TRUE)
little_train <- little_train[ ,nzv$nzv ==FALSE]
little_test  <- little_test [  ,nzv$nzv==FALSE]
# The first column is just row numbers:
little_train <- little_train[c(-1)]
dim(little_train)
```

It seems as though there are a lot of columns with an overwhelming majority of `NA` values. Even setting a limit as low as $1\%$ of non-empty entries, we could eliminate them:

```{r}
throw_away <- function(x){
empty <- rep(0, length(x))
for(i in 1:length(x)){
    if ((sum(is.na(x[ ,i])) / nrow(x)) > 0.95){ # We throw away columns with less than 5% of observations/no.of rows
        empty[i] <- i  
    } 
    else{
        empty[i] <- NA
    }
}
    na.omit(empty)
}

little_train <- little_train[ ,c(-throw_away(little_train))]
dim(little_train)
```
---

###**Data analysis:**

```{r}
fit <- rpart(classe ~ ., data=little_train, method="class") # Classification tree
printcp(fit)
plot(fit)
text(fit, cex = 0.5)
```